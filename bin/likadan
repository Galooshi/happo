#!/usr/bin/env ruby

require 'likadan_utils'
require 'likadan_action'
require 'likadan_uploader'
require 'fileutils'

action = ARGV[0] || 'run'
case action
when 'run'
  Thread.new do # trivial example work thread
    begin
      require 'likadan_runner'
    ensure
      exit
    end
  end
  require 'likadan_server'

when 'review'
  system 'open', LikadanUtils.construct_url('/review')
  require 'likadan_server'

when 'prune'
  FileUtils.remove_entry_secure LikadanUtils.config['snapshots_folder']

when 'approve', 'reject'
  abort 'Missing example name' unless example_name = ARGV[1]
  abort 'Missing viewport width' unless width = ARGV[2]
  LikadanAction.new(example_name, width).send(action)

when 'upload_diffs'
  # `upload_diffs` returns a URL to a static html file
  puts LikadanUploader.new.upload_diffs
else
  abort "Unknown action \"#{action}\""
end
